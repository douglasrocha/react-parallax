"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x2,_x3,_x4){for(var _again=!0;_again;){var object=_x2,property=_x3,receiver=_x4;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x2=parent,_x3=property,_x4=receiver,_again=!0,desc=parent=void 0}},_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),Parallax=function(_React$Component){function Parallax(props){_classCallCheck(this,Parallax),_get(Object.getPrototypeOf(Parallax.prototype),"constructor",this).call(this,props),this.ReactDOM=_reactDom2.default.findDOMNode?_reactDom2.default:_react2.default,this.node=null,this.windowHeight=this.getWindowHeight(),this.childStyle=this.getChildStyle(),this.timestamp=Date.now(),this.autobind()}return _inherits(Parallax,_React$Component),_createClass(Parallax,[{key:"autobind",value:function(){this.onScroll=this.onScroll.bind(this),this.onWindowResize=this.onWindowResize.bind(this),this.updatePosition=this.updatePosition.bind(this),this.onWindowLoad=this.onWindowLoad.bind(this)}},{key:"render",value:function(){return _react2.default.createElement("div",{className:"react-parallax"},this.props.bgImage?_react2.default.createElement("img",{className:"react-parallax-bgimage",src:this.props.bgImage,ref:"bgImage",alt:""}):"",this.props.bgVideo?_react2.default.createElement("video",{autoPlay:!0,loop:!0,muted:!0,ref:"bgImage",className:"react-parallax-bgimage"},_react2.default.createElement("source",{src:this.props.bgVideo,type:"video/ogg"})):"",_react2.default.createElement("div",{className:"react-parallax-content",style:this.childStyle,ref:"content"},this.props.children))}},{key:"componentWillMount",value:function(){document.addEventListener("scroll",this.onScroll,!1),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("load",this.onWindowLoad,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("scroll",this.onScroll,!1),window.removeEventListener("resize",this.onWindowResize,!1),window.removeEventListener("load",this.onWindowLoad,!1)}},{key:"componentDidMount",value:function(){this.node=this.ReactDOM.findDOMNode(this),this.img=this.refs.bgImage?this.ReactDOM.findDOMNode(this.refs.bgImage):null,this.updatePosition(),this.setParallaxStyle(),this.setInitialBackgroundStyles()}},{key:"onScroll",value:function(event){var stamp=Date.now();stamp-this.timestamp>=10&&this.isScrolledIntoView(this.node)&&(window.requestAnimationFrame(this.updatePosition),this.timestamp=stamp)}},{key:"onWindowLoad",value:function(){this.updatePosition()}},{key:"updatePosition",value:function(){var autoHeight=!1,content=this.ReactDOM.findDOMNode(this.refs.content);this.contentHeight=content.getBoundingClientRect().height,this.contentWidth=this.node.getBoundingClientRect().width,this.img&&this.img.naturalWidth/(this.img.naturalHeight-this.props.strength)*this.contentHeight<this.contentWidth&&(autoHeight=!0);var rect=this.node.getBoundingClientRect();rect&&this.setImagePosition(rect.top,autoHeight)}},{key:"setImagePosition",value:function(top){var autoHeight=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],backPos=0;!0!==this.props.disabled&&(backPos=Math.floor((top+this.contentHeight)/this.windowHeight*this.props.strength));var height=autoHeight?"auto":Math.floor(this.contentHeight+this.props.strength),width=autoHeight?this.contentWidth:"auto";this.img.style.WebkitTransform="translate3d(-50%, -"+backPos+"px, 0)",this.img.style.transform="translate3d(-50%, -"+backPos+"px, 0)",this.img.style.height=height,this.img.style.width=width,this.props.blur&&(this.img.style.WebkitFilter="blur("+this.props.blur+"px)",this.img.style.filter="blur("+this.props.blur+"px)")}},{key:"setInitialBackgroundStyles",value:function(){this.img&&(this.img.style.position="absolute",this.img.style.left="50%",this.img.style.WebkitTransformStyle="preserve-3d",this.img.style.WebkitBackfaceVisibility="hidden",this.img.style.MozBackfaceVisibility="hidden",this.img.style.MsBackfaceVisibility="hidden")}},{key:"onWindowResize",value:function(){this.windowHeight=this.getWindowHeight(),this.updatePosition()}},{key:"setParallaxStyle",value:function(){this.node&&(this.node.style.position="relative",this.node.style.overflow="hidden",this.node.style.background=this.props.bgColor)}},{key:"getChildStyle",value:function(){return{position:"relative"}}},{key:"getWindowHeight",value:function(){var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0];return w.innerHeight||e.clientHeight||g.clientHeight}},{key:"isScrolledIntoView",value:function(element){var elementTop=element.getBoundingClientRect().top,elementBottom=element.getBoundingClientRect().bottom;return elementTop<=0&&elementBottom>=0||elementTop>=0&&elementBottom<=window.innerHeight||elementTop<=window.innerHeight&&elementBottom>=window.innerHeight}},{key:"log",value:function(){this.props.log&&console.log(arguments)}}]),Parallax}(_react2.default.Component);exports.default=Parallax,Parallax.propTypes={bgVideo:_react2.default.PropTypes.string,bgColor:_react2.default.PropTypes.string,strength:_react2.default.PropTypes.number,blur:_react2.default.PropTypes.number},Parallax.defaultProps={bgColor:"#fff",strength:100,blur:0,log:!1,disabled:!1},module.exports=exports.default;